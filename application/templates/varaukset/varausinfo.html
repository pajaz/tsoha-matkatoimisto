{% extends "layout.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block body %}
{% if current_user.id == varaus.user_id or current_user.admin == 1 %}
<div class="col-md-6 col-xs-10 middle-column">
    <h2> Varauksen tiedot </h2>
    <h3> Matkakohde: {{ matkakohde.name }}, {{ matkakohde.country }}</h3>
    <h3> Lähtöpäivä: {{ date }} </h3>
    <!-- Tähän väliin paluu pvm -->
   
    <div class="card">
        <div class="card-body row">
            <h4 class="card-title col-12"> Matkustajia: {{ varaus.passengers }}</h4>
            {% for i,j,k,l in matkustajat %}
            <div class="col-6 card-text">
                <p>{{ i }} {{ j }}  <br/>
                Henkilötunnus: {{ k }}  </p>
            </div> 
                {% if not varaus.confirmed %}
            <div class="col-3">
                <form method="POST" action="{{ url_for('delete_matkustaja', matkustaja_id = l , varaus_id = varaus.id, previous_page = 'varaus_info') }}">
                <input class="btn btn-warning" type="submit" value="Poista Matkustaja"/></form>
            </div> 
                {% endif %}
            {% endfor %}
            {% if varaus.passengers > matkustajat|length %}
            <div class="col-12">
                <form method="POST" action="{{ url_for('varaus_info', varaus_id=varaus.id) }}" class="form" role="form">
                    {{ errors }}
                    {{ wtf.form_field(form.fname, class="form-control", placeholder="...") }}
                    {{ wtf.form_field(form.lname, class="form-control", placeholder="...") }}
                    {{ wtf.form_field(form.socialsec, class="form-control", placeholder="...") }}
                    <input type="submit" class="btn btn-default" value="Lisää"/>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
    {% if hotel %}
    <div class="card">
        <div class="card-body">
            <h4 class="card-title"> Hotelli: {{ hotel.name }} </h4>
            <h5> Huoneet:</h5>
            <p>1-2 henkilöä: {{ varaus.small_rooms }}</p>
            <p>3-4 henkilöä: {{ varaus.large_rooms }}</p>
        </div>  
    </div>
    {% endif %}
    <h4>Hinta: {{ varaus.price }}€</h4>
    {% if varaus.confirmed %}
    <div class="card">
        <p>Olet vahvistanut varauksen tiedot</p>
        <p>Lasku lähetetty: {{ lasku }}</p>
        <p>Maksun tila: {{ maksettu }}</p>
        
    </div>
    {% endif %}
    {% if (varaus.passengers == matkustajat|length) and (not varaus.confirmed) %}
    <form method="POST" action="{{ url_for('varaus_info', varaus_id=varaus.id, confirm = True) }}">
            <input type="submit" class="btn btn-default" value="Vahvista tiedot"/>
    </form>
    {% elif (varaus.confirmed) and (not lasku) %}
    <form method="POST" action="{{ url_for('varaus_info', varaus_id=varaus.id, lasku = True) }}">
            <input type="submit" class="btn btn-default" value="Lasku lähetetty"/>
    </form> 
    {% elif (lasku) and (not maksettu) %}
    <form method="POST" action="{{ url_for('varaus_info', varaus_id=varaus.id, maksettu = True) }}">
            <input type="submit" class="btn btn-default" value="Lasku maksettu"/>
    </form> 
    {% endif %}    
    <p>Varausta voi muokata niin kauan, kun et ole vahvistanut sen tietoja.</p>
    <p>Tietojen vahvistaminen on mahdollista, kun kaikkien matkustajien tiedot on syötetty</p>
    
</div>
{% else %}
<div class="container-fluid">
    <p>Valitettavasti sinulla ei ole oikeuksia tarkastella tätä sivua </p>
    <a href="{{ url_for('matkakohteet_index') }}">Takaisin etusivulle</a>
</div>
{% endif %}
{% endblock %}
